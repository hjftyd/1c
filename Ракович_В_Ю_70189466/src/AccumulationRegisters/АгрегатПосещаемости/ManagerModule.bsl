// Получить статистику посещений за период
Функция ПолучитьСтатистикуПосещений(ДатаНачала, ДатаОкончания, Группа = Неопределено) Экспорт
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    АгрегатПосещаемости.Студент.Группа КАК Группа,
    |    АгрегатПосещаемости.ПричинаПосещения,
    |    СУММА(АгрегатПосещаемости.КоличествоПосещений) КАК ВсегоПосещений,
    |    СРЕДНЕЕ(АгрегатПосещаемости.СреднееВремяПриема) КАК СреднееВремя
    |ИЗ
    |    РегистрНакопления.АгрегатПосещаемости КАК АгрегатПосещаемости
    |ГДЕ
    |    АгрегатПосещаемости.ПериодПосещения МЕЖДУ &ДатаНачала И &ДатаОкончания
    |    И (&Группа = ЗНАЧЕНИЕ(Справочник.Группы.ПустаяСсылка)
    |        ИЛИ АгрегатПосещаемости.Студент.Группа = &Группа)
    |
    |СГРУППИРОВАТЬ ПО
    |    АгрегатПосещаемости.Студент.Группа,
    |    АгрегатПосещаемости.ПричинаПосещения
    |
    |УПОРЯДОЧИТЬ ПО
    |    АгрегатПосещаемости.Студент.Группа,
    |    ВсегоПосещений УБЫВ";
    
    Если ЗначениеЗаполнено(Группа) Тогда
        Запрос.УстановитьПараметр("Группа", Группа);
    Иначе
        Запрос.УстановитьПараметр("Группа", Справочники.Группы.ПустаяСсылка);
    КонецЕсли;
    
    Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
    Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
    
    Возврат Запрос.Выполнить().Выгрузить();
    
КонецФункции

// Найти студентов с частыми посещениями
Функция НайтиЧастоБолеющих(ПорогПосещений, ДатаНачала, ДатаОкончания) Экспорт
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    АгрегатПосещаемости.Студент,
    |    СУММА(АгрегатПосещаемости.КоличествоПосещений) КАК ВсегоПосещений
    |ИЗ
    |    РегистрНакопления.АгрегатПосещаемости КАК АгрегатПосещаемости
    |ГДЕ
    |    АгрегатПосещаемости.ПериодПосещения МЕЖДУ &ДатаНачала И &ДатаОкончания
    |    И АгрегатПосещаемости.ПричинаПосещения = &ПричинаЗаболевание
    |
    |СГРУППИРОВАТЬ ПО
    |    АгрегатПосещаемости.Студент
    |
    |ИМЕЮЩИЕ
    |    СУММА(АгрегатПосещаемости.КоличествоПосещений) >= &Порог
    |
    |УПОРЯДОЧИТЬ ПО
    |    ВсегоПосещений УБЫВ";
    
    Запрос.УстановитьПараметр("Порог", ПорогПосещений);
    Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
    Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
    Запрос.УстановитьПараметр("ПричинаЗаболевание", "Жалоба");
    
    Возврат Запрос.Выполнить().Выгрузить();
    
КонецФункции