// Проверить наличие прививки у студента
Функция ПроверитьНаличиеПрививки(Студент, Прививка) Экспорт
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ ВЕРХ 1
    |    КартаПрививок.ДатаВакцинации
    |ИЗ
    |    РегистрСведений.КартаПрививок КАК КартаПрививок
    |ГДЕ
    |    КартаПрививок.Студент = &Студент
    |    И КартаПрививок.Прививка = &Прививка
    |УПОРЯДОЧИТЬ ПО
    |    КартаПрививок.ДатаВакцинации УБЫВ";
    
    Запрос.УстановитьПараметр("Студент", Студент);
    Запрос.УстановитьПараметр("Прививка", Прививка);
    
    Возврат Не Запрос.Выполнить().Пустой();
    
КонецФункции

// Получить план прививок для группы
Функция ПолучитьПланПрививокДляГруппы(Группа, НаДату) Экспорт
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    Студенты.Наименование КАК Студент,
    |    Прививки.Наименование КАК ТребуемаяПрививка,
    |    Прививки.ВозрастНачала,
    |    Прививки.Периодичность
    |ИЗ
    |    Справочник.Студенты КАК Студенты
    |        ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Прививки КАК Прививки
    |        ПО Прививки.Обязательная = ИСТИНА
    |ГДЕ
    |    Студенты.Группа = &Группа
    |    И Студенты.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусСтудента.Активный)
    |    И НЕ СУЩЕСТВУЕТ(
    |        ВЫБРАТЬ
    |            КартаПрививок.Ссылка
    |        ИЗ
    |            РегистрСведений.КартаПрививок КАК КартаПрививок
    |        ГДЕ
    |            КартаПрививок.Студент = Студенты.Ссылка
    |            И КартаПрививок.Прививка = Прививки.Ссылка
    |            И КартаПрививок.ДатаВакцинации >= &НаДату - Прививки.Периодичность
    |    )
    |
    |УПОРЯДОЧИТЬ ПО
    |    Студент,
    |    Прививки.ВозрастНачала";
    
    Запрос.УстановитьПараметр("Группа", Группа);
    Запрос.УстановитьПараметр("НаДату", НаДату);
    
    Возврат Запрос.Выполнить().Выгрузить();
    
КонецФункции