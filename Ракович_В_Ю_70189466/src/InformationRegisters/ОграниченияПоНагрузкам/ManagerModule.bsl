// Получить активные ограничения студента
Функция ПолучитьАктивныеОграничения(Студент, НаДату = Неопределено) Экспорт
    
    Если НаДату = Неопределено Тогда
        НаДату = ТекущаяДата();
    КонецЕсли;
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    ОграниченияПоНагрузкам.ВидНагрузки,
    |    ОграниченияПоНагрузкам.УровеньОграничения,
    |    ОграниченияПоНагрузкам.ДатаОкончания,
    |    ОграниченияПоНагрузкам.Причина
    |ИЗ
    |    РегистрСведений.ОграниченияПоНагрузкам КАК ОграниченияПоНагрузкам
    |ГДЕ
    |    ОграниченияПоНагрузкам.Студент = &Студент
    |    И ОграниченияПоНагрузкам.Активно = ИСТИНА
    |    И ОграниченияПоНагрузкам.ДатаНачала <= &НаДату
    |    И (ОграниченияПоНагрузкам.ДатаОкончания >= &НаДату
    |        ИЛИ ОграниченияПоНагрузкам.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1))
    |
    |УПОРЯДОЧИТЬ ПО
    |    ОграниченияПоНагрузкам.УровеньОграничения УБЫВ";
    
    Запрос.УстановитьПараметр("Студент", Студент);
    Запрос.УстановитьПараметр("НаДату", НаДату);
    
    Возврат Запрос.Выполнить().Выгрузить();
    
КонецФункции

// Проверить возможность занятия
Функция ПроверитьВозможностьЗанятия(Студент, ВидНагрузки, НаДату = Неопределено) Экспорт
    
    Если НаДату = Неопределено Тогда
        НаДату = ТекущаяДата();
    КонецЕсли;
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ ВЕРХ 1
    |    ОграниченияПоНагрузкам.УровеньОграничения
    |ИЗ
    |    РегистрСведений.ОграниченияПоНагрузкам КАК ОграниченияПоНагрузкам
    |ГДЕ
    |    ОграниченияПоНагрузкам.Студент = &Студент
    |    И ОграниченияПоНагрузкам.Активно = ИСТИНА
    |    И (ОграниченияПоНагрузкам.ВидНагрузки = &ВидНагрузки
    |        ИЛИ ОграниченияПоНагрузкам.ВидНагрузки = ""Общие ограничения"")
    |    И ОграниченияПоНагрузкам.ДатаНачала <= &НаДату
    |    И (ОграниченияПоНагрузкам.ДатаОкончания >= &НаДату
    |        ИЛИ ОграниченияПоНагрузкам.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1))
    |
    |УПОРЯДОЧИТЬ ПО
    |    ОграниченияПоНагрузкам.УровеньОграничения УБЫВ";
    
    Запрос.УстановитьПараметр("Студент", Студент);
    Запрос.УстановитьПараметр("ВидНагрузки", ВидНагрузки);
    Запрос.УстановитьПараметр("НаДату", НаДату);
    
    Результат = Запрос.Выполнить();
    Если Не Результат.Пустой() Тогда
        Выборка = Результат.Выбрать();
        Выборка.Следующий();
        Возврат Выборка.УровеньОграничения;
    КонецЕсли;
    
    Возврат Перечисления.УровеньОграничения.НетОграничений;
    
КонецФункции